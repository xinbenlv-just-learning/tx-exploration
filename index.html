<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue App</title>
    <link href="https://unpkg.com/ant-design-vue@1.7.2/dist/antd.css" rel="stylesheet">
    <script src="https://unpkg.com/vue@2.6.12/dist/vue.js"></script>
    <script src="https://unpkg.com/ant-design-vue@1.7.2/dist/antd.js"></script>
</head>
<body>
    <div id="app">
        <h1>Get the TX information</h1>
        <p>API Key = {{apiKey}}</p>
        <p>Address = {{address}}</p>
        <a-button type="primary" @click="fetchTransactions">Fetch Transactions</a-button>
        <a-table :columns="columns" :data-source="transactions" :row-key="record => record.hash" bordered>
            <template slot="hash" slot-scope="text, record">
                <a :href="`https://etherscan.io/tx/${record.hash}`" target="_blank">{{text}}</a>
            </template>
        </a-table>
        <p>Total Gas Used = {{totalGasUsed}}</p>
        <p>Gas Price = {{gasPrice}} gwei</p>
        <p>Ethereum Price = {{ethereumPriceInUsed}} usd</p>
        <p>Total Gas Used In Ether = {{totalGasUsedInEther}} ether</p>
        <p>Total Gas Used In Usd = {{totalGasUsedInUsd}} usd</p>

        <p v-if="transactions.length === 0">No transactions found.</p>
        <p v-else>{{transactions.length}} tx found.</p>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                transactions: [],
                apiKey: 'no key',
                address: 'no key',
                gasPrice: 0,
                ethereumPriceInUsed: 0,
                totalGasUsed: 0,
                totalGasUsedInEther: 0,
                totalGasUsedInUsd: 0,
                columns: [
                    {
                        title: 'Hash',
                        dataIndex: 'hash',
                        key: 'hash'
                    },
                    {
                        title: 'Gas Used',
                        dataIndex: 'gasUsed',
                        key: 'gasused',
                    },
                ]
            },
            created() {
                const urlParams = new URLSearchParams(window.location.search);
                    this.apiKey = urlParams.get('apiKey');
                    this.address = urlParams.get('address');
            },
            methods: {
                async fetchTransactions() {

                    console.log(`this.apiKey`, this.apiKey);
                    console.log(`this.address`, this.address);
                    const url = `https://api-sepolia.etherscan.io/api?module=account&action=txlist&address=${this.address}&startblock=0&endblock=99999999&sort=asc&apikey=${this.apiKey}`;

                    const response = await fetch(url);
                    const data = await response.json();

                    this.transactions = [...data.result.map(tx => ({
                            key: tx.hash,
                            ...tx
                        }))
                    ];
                    console.log(`this.transactions`, this.transactions);
                    this.totalGasUsed = 0;
                    this.transactions.forEach(tx => {
                        this.totalGasUsed += parseInt(tx.gasUsed);
                    });
                    console.log(`totalGasUsed`, this.totalGasUsed);
                    this.gasPrice = "17"; // gwei
                    this.ethereumPriceInUsed = "2400"; // usd
                    this.totalGasUsedInEther = this.totalGasUsed * parseInt(this.gasPrice) / 1000000000;
                    console.log(`totalGasUsedInEther`, this.totalGasUsedInEther, "ether");
                    this.totalGasUsedInUsd = this.totalGasUsedInEther * parseInt(this.ethereumPriceInUsed);
                    console.log(`totalGasUsedInUsd`, this.totalGasUsedInUsd, "usd");
                },
            },
        });
    </script>
</body>
</html>